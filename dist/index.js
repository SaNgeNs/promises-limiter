"use strict";Object.defineProperty(exports, "__esModule", {value: true});var a=class{#n;#e;#s=0;#t=0;#i=!1;#r=[];async#o(s){let t=new AbortController;this.#r.push(t);let{signal:r}=t;try{return await s(r)}catch(e){return this.#t++,this.#e.onError&&this.#e.onError(e),e}finally{this.#r=this.#r.filter(e=>e!==t)}}constructor(s,t){this.#n=s,this.#e={maxConcurrent:10,delayBetweenBatches:0,progressiveDelayStep:0,maxProgressiveDelay:0,...t}}cancel(){this.#i=!0,this.#r.forEach(s=>s.abort())}async run(){this.#s=0,this.#t=0;let s=[],t=[],r=this.#e.delayBetweenBatches,e=0,i=this.#n.length;for(;e<i&&!this.#i;){let c=this.#n.slice(e,e+this.#e.maxConcurrent);e+=this.#e.maxConcurrent,await Promise.all(c.map(async o=>{let n=await this.#o(o);n&&!(n instanceof Error)?(this.#s++,this.#e.onSuccess&&this.#e.onSuccess(n),s.push(n)):t.push(n),this.#e.onProgress&&this.#e.onProgress({completed:this.#s,remaining:Math.max(i-(this.#s+this.#t),0),failed:this.#t})})),e<i&&(await new Promise(o=>{setTimeout(o,r)}),r=Math.min(r+this.#e.progressiveDelayStep,this.#e.maxProgressiveDelay||r))}return this.#e.onComplete&&!this.#i&&this.#e.onComplete({success:s,failed:t}),{success:s,failed:t}}},u= exports.default =a;exports.default = u;
//# sourceMappingURL=index.js.map